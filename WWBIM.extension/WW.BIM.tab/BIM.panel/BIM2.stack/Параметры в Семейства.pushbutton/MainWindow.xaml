<Window xmlns='http://schemas.microsoft.com/winfx/2006/xaml/presentation'
        xmlns:x='http://schemas.microsoft.com/winfx/2006/xaml'
        Title='Пакетное добавление общих параметров в семейства'
        Height='700' Width='950' MinHeight='500' MinWidth='750'
        WindowStartupLocation='CenterScreen'
        Background='#F5F5F5'>

  <Window.Resources>
    <!-- Общие стили -->
    <Style TargetType='GroupBox'>
      <Setter Property='Padding' Value='10'/>
      <Setter Property='Margin' Value='0,0,0,10'/>
    </Style>
    <Style TargetType='Button'>
      <Setter Property='Padding' Value='12,6'/>
      <Setter Property='MinWidth' Value='90'/>
    </Style>
    <Style TargetType='TextBlock'>
      <Setter Property='Margin' Value='0,0,0,4'/>
    </Style>
    <Style TargetType='ListBox'>
      <Setter Property='BorderThickness' Value='1'/>
      <Setter Property='BorderBrush' Value='#CCCCCC'/>
    </Style>
    <Style TargetType='DataGrid'>
      <Setter Property='BorderThickness' Value='1'/>
      <Setter Property='BorderBrush' Value='#CCCCCC'/>
      <Setter Property='GridLinesVisibility' Value='Horizontal'/>
      <Setter Property='HorizontalGridLinesBrush' Value='#EEEEEE'/>
    </Style>
  </Window.Resources>

  <Grid Margin='15'>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width='240' MinWidth='200'/>
      <ColumnDefinition Width='15'/>
      <ColumnDefinition Width='*'/>
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
      <RowDefinition Height='*'/>
      <RowDefinition Height='Auto'/>
    </Grid.RowDefinitions>

    <!-- Левая панель: Режим работы -->
    <GroupBox Header='Добавить параметры в:' Grid.Column='0' Grid.Row='0' VerticalAlignment='Top'>
      <StackPanel>
        <RadioButton x:Name='rbActive' Content='Активное семейство' IsChecked='True' Margin='0,2,0,8'/>
        <RadioButton x:Name='rbOpen' Content='Все открытые семейства' Margin='0,0,0,8'/>
        <RadioButton x:Name='rbFolder' Content='Семейства в папке' Margin='0,0,0,10'/>
        <Button x:Name='btnPickFolder' Content='Выбрать папку...' IsEnabled='False' HorizontalAlignment='Stretch'/>
      </StackPanel>
    </GroupBox>

    <!-- Правая панель: Основное содержимое -->
    <Grid Grid.Column='2' Grid.Row='0'>
      <Grid.RowDefinitions>
        <RowDefinition Height='Auto' MinHeight='180'/>
        <RowDefinition Height='Auto'/>
        <RowDefinition Height='*' MinHeight='150'/>
      </Grid.RowDefinitions>

      <!-- Выбор параметров -->
      <Grid Grid.Row='0' Height='220'>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width='*'/>
          <ColumnDefinition Width='15'/>
          <ColumnDefinition Width='1.2*'/>
        </Grid.ColumnDefinitions>

        <GroupBox Header='Группа параметров:' Grid.Column='0' Margin='0,0,0,10'>
          <ListBox x:Name='lbGroups'/>
        </GroupBox>

        <GroupBox Header='Параметры:' Grid.Column='2' Margin='0,0,0,10'>
          <ListBox x:Name='lbParams' SelectionMode='Extended'/>
        </GroupBox>
      </Grid>

      <!-- Настройки добавления -->
      <Border Grid.Row='1' Background='#FFFFFF' BorderBrush='#DDDDDD' BorderThickness='1' CornerRadius='4' Padding='12' Margin='0,0,0,10'>
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width='Auto'/>
            <ColumnDefinition Width='20'/>
            <ColumnDefinition Width='Auto'/>
            <ColumnDefinition Width='20'/>
            <ColumnDefinition Width='*'/>
            <ColumnDefinition Width='20'/>
            <ColumnDefinition Width='Auto'/>
          </Grid.ColumnDefinitions>

          <!-- Группирование -->
          <StackPanel Grid.Column='0'>
            <TextBlock Text='Группирование:' FontWeight='SemiBold'/>
            <ComboBox x:Name='cbBipg' MinWidth='160' VerticalAlignment='Center'/>
          </StackPanel>

          <!-- Тип/Экземпляр -->
          <StackPanel Grid.Column='2'>
            <TextBlock Text='Добавить как:' FontWeight='SemiBold'/>
            <StackPanel Orientation='Horizontal' Margin='0,6,0,0'>
              <RadioButton x:Name='rbType' Content='Тип' Margin='0,0,20,0' VerticalAlignment='Center'/>
              <RadioButton x:Name='rbInst' Content='Экземпляр' IsChecked='True' VerticalAlignment='Center'/>
            </StackPanel>
          </StackPanel>

          <!-- Формула/Значение -->
          <StackPanel Grid.Column='4'>
            <TextBlock Text='Формула / значение:' FontWeight='SemiBold'/>
            <TextBox x:Name='tbFormula' MinWidth='150' VerticalAlignment='Center'/>
          </StackPanel>

          <!-- Кнопка Добавить -->
          <Button x:Name='btnAdd' Grid.Column='6' Content='Добавить ▶' VerticalAlignment='Bottom' MinWidth='110'/>
        </Grid>
      </Border>

      <!-- Очередь добавления -->
      <GroupBox Grid.Row='2' Header='Очередь добавления' Margin='0'>
        <DockPanel>
          <!-- Кнопки управления очередью -->
          <StackPanel DockPanel.Dock='Bottom' Orientation='Horizontal' Margin='0,10,0,0'>
            <Button x:Name='btnOpen' Content='Открыть...' Margin='0,0,8,0'/>
            <Button x:Name='btnSave' Content='Сохранить...' Margin='0,0,8,0'/>
            <Button x:Name='btnRemove' Content='Удалить'/>
          </StackPanel>

          <!-- Таблица очереди -->
          <DataGrid x:Name='dgQueue' AutoGenerateColumns='False' CanUserAddRows='False'
                    IsReadOnly='False' SelectionMode='Extended' HeadersVisibility='Column'
                    RowHeight='26' ColumnHeaderHeight='28'>
            <DataGrid.Columns>
              <DataGridTextColumn Header='Параметр' Binding='{Binding Name}' IsReadOnly='True' Width='*' MinWidth='120'/>
              <DataGridCheckBoxColumn Header='Экз.' Binding='{Binding IsInstance, Mode=TwoWay}' Width='50'/>
              <DataGridComboBoxColumn x:Name='colBipg' Header='Группирование'
                                      SelectedValueBinding='{Binding Bipg, Mode=TwoWay}' Width='180'/>
              <DataGridTextColumn Header='Формула / Значение'
                                  Binding='{Binding Formula, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}'
                                  Width='200'/>
            </DataGrid.Columns>
          </DataGrid>
        </DockPanel>
      </GroupBox>
    </Grid>

    <!-- Нижняя панель: Кнопки OK/Отмена -->
    <Border Grid.Row='1' Grid.ColumnSpan='3' BorderBrush='#DDDDDD' BorderThickness='0,1,0,0' Margin='-15,15,-15,0' Padding='15,15,15,0'>
      <StackPanel Orientation='Horizontal' HorizontalAlignment='Right'>
        <Button x:Name='btnOk' Content='Выполнить' MinWidth='110' Margin='0,0,10,0'/>
        <Button x:Name='btnCancel' Content='Отмена' MinWidth='100'/>
      </StackPanel>
    </Border>

  </Grid>
</Window>
